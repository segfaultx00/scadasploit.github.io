<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="ie=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="author" content="segfaultx00 ">
<meta name="description" content="Let&amp;rsquo;s get to know SCADAsploit a little better starting from one of the auxiliary modules present: Modbus Scan.
Position ourselves in the folder where we installed SCADAsploit and start it using the command $ ./scadasploit.py. Following the same approach philosophy of Metasploit, we can search for all modules that contain a keyword using the search &amp;lt;keyword&amp;gt; command or display the complete list of modules present with the show modules command." />
<meta name="keywords" content=", SCADAsploit" />
<meta name="robots" content="noodp" />
<meta name="theme-color" content="" />
<link rel="canonical" href="https://scadasploit.dev/posts/2022/04/scadasploit-module-modbus-scan/" />


    <title>
        
            SCADAsploit module: Modbus Scan :: SCADAsploit 
        
    </title>



<link href="https://cdnjs.cloudflare.com/ajax/libs/flag-icon-css/3.5.0/css/flag-icon.min.css" rel="stylesheet"
    type="text/css">



<link rel="stylesheet" href="https://scadasploit.dev/main.dacbc4bc3c700b51f08b5ac83e9eb70daf49d755028b1490288a2e6193098272.css">



    <link rel="apple-touch-icon" sizes="180x180" href="https://scadasploit.dev/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="https://scadasploit.dev/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="https://scadasploit.dev/favicon-16x16.png">
    <link rel="manifest" href="https://scadasploit.dev/site.webmanifest">
    <link rel="mask-icon" href="https://scadasploit.dev/safari-pinned-tab.svg" color="">
    <link rel="shortcut icon" href="https://scadasploit.dev/favicon.ico">
    <meta name="msapplication-TileColor" content="">


<meta itemprop="name" content="SCADAsploit module: Modbus Scan">
<meta itemprop="description" content="Let&rsquo;s get to know SCADAsploit a little better starting from one of the auxiliary modules present: Modbus Scan.
Position ourselves in the folder where we installed SCADAsploit and start it using the command $ ./scadasploit.py. Following the same approach philosophy of Metasploit, we can search for all modules that contain a keyword using the search &lt;keyword&gt; command or display the complete list of modules present with the show modules command."><meta itemprop="datePublished" content="2022-04-17T15:09:35+02:00" />
<meta itemprop="dateModified" content="2022-04-17T15:09:35+02:00" />
<meta itemprop="wordCount" content="975"><meta itemprop="image" content="https://scadasploit.dev"/>
<meta itemprop="keywords" content="SCADAsploit," />
<meta name="twitter:card" content="summary_large_image"/>
<meta name="twitter:image" content="https://scadasploit.dev"/>

<meta name="twitter:title" content="SCADAsploit module: Modbus Scan"/>
<meta name="twitter:description" content="Let&rsquo;s get to know SCADAsploit a little better starting from one of the auxiliary modules present: Modbus Scan.
Position ourselves in the folder where we installed SCADAsploit and start it using the command $ ./scadasploit.py. Following the same approach philosophy of Metasploit, we can search for all modules that contain a keyword using the search &lt;keyword&gt; command or display the complete list of modules present with the show modules command."/>



    <meta property="og:title" content="SCADAsploit module: Modbus Scan" />
<meta property="og:description" content="Let&rsquo;s get to know SCADAsploit a little better starting from one of the auxiliary modules present: Modbus Scan.
Position ourselves in the folder where we installed SCADAsploit and start it using the command $ ./scadasploit.py. Following the same approach philosophy of Metasploit, we can search for all modules that contain a keyword using the search &lt;keyword&gt; command or display the complete list of modules present with the show modules command." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://scadasploit.dev/posts/2022/04/scadasploit-module-modbus-scan/" /><meta property="og:image" content="https://scadasploit.dev"/><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2022-04-17T15:09:35+02:00" />
<meta property="article:modified_time" content="2022-04-17T15:09:35+02:00" />






    <meta property="article:published_time" content="2022-04-17 15:09:35 &#43;0200 CEST" />










    </head>

    
        <body>
    
    
        <div class="container">
            <header class="header">
    <span class="header__inner">
        <a href="https://scadasploit.dev/" style="text-decoration: none;">
    <div class="logo">
        
            <span class="logo__mark">$</span>
            <span class="logo__text"> ssf &gt; </span>
            <span class="logo__cursor" style=
                  "
                   background-color:#a90c1c;
                   animation-duration:1s;">
            </span>
        
    </div>
</a>


        <span class="header__right">
            
                <nav class="menu">
    <ul class="menu__inner"><li><a href="https://scadasploit.dev/features/">01_Features</a></li><li><a href="https://scadasploit.dev/posts/">02_Blogs</a></li><li><a href="https://scadasploit.dev/workshop/">03_Workshop</a></li><li><a href="https://scadasploit.dev/contact/">04_Contact</a></li>
    </ul>
</nav>

                <span class="menu-trigger">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
                        <path d="M0 0h24v24H0z" fill="none"/>
                        <path d="M3 18h18v-2H3v2zm0-5h18v-2H3v2zm0-7v2h18V6H3z"/>
                    </svg>
                </span>
            
        </span>
    </span>
</header>


            <div class="content">
                
  <main class="post">

    <div class="post-info">
      <p>
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-clock">
          <circle cx="12" cy="12" r="10"></circle>
          <polyline points="12 6 12 12 16 14"></polyline>
        </svg>
        5 minutes

        
      </p>
    </div>

    <article>
      <h1 class="post-title">
        <a href="https://scadasploit.dev/posts/2022/04/scadasploit-module-modbus-scan/">SCADAsploit module: Modbus Scan</a>
      </h1>

      

      

      

      <div class="post-content">
        <html>
  <style>
  .container {
    align-items: center;
  }
  .my_img {
    max-width: 100%;
    max-height: 100%;
    padding-top: 0px;
    border: 1px solid #A90C1C;
    box-shadow: 0 0 6px 6px rgba(169, 12, 28, 0.3);
  }
  .my_title {
    color: #FFFFFF;
    font-size: 38px;
    padding-top: 0px;
  }
  .my_sub_title {
    font-size: 24px;
    padding-left: 5%;
    padding-right: 5%;
    text-align: justify;
  }
  .my_text {
    font-size: 18px;
    padding-left: 20%;
    padding-right: 20%;
    text-align: justify;
  }
  .my_img_description {
    font-size: 18px;
    text-align: justify;
  }
  </style>
</html>
<p>Let&rsquo;s get to know SCADAsploit a little better starting from one of the auxiliary modules present: <strong>Modbus Scan</strong>.</p>
<p>Position ourselves in the folder where we installed SCADAsploit and start it using the command <code>$ ./scadasploit.py</code>. Following the same approach philosophy of Metasploit, we can search for all modules that contain a keyword using the <code>search &lt;keyword&gt;</code> command or display the complete list of modules present with the <code>show modules</code> command.</p>
<p>In our case we will use <code>search modbus</code> to identify the SCADAsploit modules that can help us during our pentesting work on a Modbus TCP network.</p>
<div class="container">
  <img
      src="https://scadasploit.dev/images/2021/scadasploit_scan_1.png"
      class="my_img"
    />
</div>
<p>The list includes both auxiliary modules and exploits, which can be recognized via the &ldquo;Path&rdquo; column. For our first test we decide to scan a Modbus TCP network, so we select the <strong>Modbus Scan</strong> module via the <code>use auxiliary/schneider/modbus_scan</code> command and display the list of parameters via the <code>show options </code>. As we can see, the module belongs to the &ldquo;auxiliary&rdquo; category.</p>
<div class="container">
  <img
      src="https://scadasploit.dev/images/2021/scadasploit_scan_2.png"
      class="my_img"
    />
</div>
<p><strong>Modbus Scan</strong> is a module for scanning devices connected to a Modbus TCP network. It can be used to scan all devices for information about the communication card, firmware version, MAC address.</p>
<p>Network scanning can be done by specifying the IP address of a single device or a range of addresses using the CIDR notation (eg 10.43.10.0/23). Alternatively, it is possible to enter the name of a text file which contains the list of IP addresses of the hosts, following a simple format which specifies the address and any non-standard port.</p>
<pre tabindex="0"><code>10.43.10.100
10.40.11.58:5020
10.0.1.1/24
</code></pre><p>In our case we scan a single device.</p>
<div class="container">
  <img
      src="https://scadasploit.dev/images/2021/scadasploit_scan_3.png"
      class="my_img"
    />
</div>
<p>And here in a moment we are able to recognize our device, the version of the firmware installed and the MAC address, all useful information for a subsequent exploit action.</p>
<h2 id="schneider-modicon-plc-and-umas">Schneider Modicon PLC and UMAS</h2>
<p>Schneider Modicon series PLCs programmed with UnityPro and based on Unity OS starting from version 2.6 use the <strong>UMAS</strong> protocol. This is a kernel-level protocol that also has an administrative level of control.</p>
<p>The UMAS structure exploits that of Modbus and is a derivative of the old Xway protocol used since the first series of Telemechanique PLCs. The main feature is that it uses the <strong>90 (0x5a)</strong> function code of the Modbus protocol to send and receive a much richer set of information. The packaging of the payload is little-endian, which may seem strange since Modbus is big-endian.</p>
<p>The UMAS packet begins with a 16-bit field specifying a &ldquo;UMAS Function Subcode&rdquo;, followed by a variable number of bytes making up the payload.</p>
<div class="container">
  <img
      src="https://scadasploit.dev/images/2021/scadasploit_scan_4.png"
      class="my_img"
    />
</div>
<p>Therefore, UMAS requests have a structure of this type:</p>
<pre tabindex="0"><code>[TCP Packet] [Modbus Header] [5A] [UMAS CODE (16 bit)] [UMAS PAYLOAD (Variable)]
</code></pre><p>Instead, all the answers follow this pattern:</p>
<pre tabindex="0"><code>[TCP Packet] [Modbus Header] [5A] [RETURN CODE (16 bit)] [UMAS PAYLOAD (Variable)]

 0x01 0xFE - OK
 0x01 0xFD - Error
</code></pre><p>When a Schneider PLC receives a Modbus packet, it checks if the function code is 0x5A and, if so, uses some specific libraries to manage the UMAS extension. There are several &ldquo;UMAS codes&rdquo; able to perform many operations on the PLC, here are some of them:</p>
<table>
<thead>
<tr>
<th>UMAS code</th>
<th>Function</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>0x01</td>
<td>INIT_COMM</td>
<td>Initialize a UMAS communication</td>
</tr>
<tr>
<td>0x02</td>
<td>READ_ID</td>
<td>Request a PLC ID</td>
</tr>
<tr>
<td>0x03</td>
<td>READ_PROJECT_INFO</td>
<td>Read Project Information</td>
</tr>
<tr>
<td>0x04</td>
<td>READ_PLC_INFO</td>
<td>Get internal PLC Info</td>
</tr>
<tr>
<td>0x06</td>
<td>READ_CARD_INFO</td>
<td>Get internal PLC SD-Card Info</td>
</tr>
<tr>
<td>0x0A</td>
<td>REPEAT</td>
<td>Sends back data sent to PLC (used for synchronization)</td>
</tr>
<tr>
<td>0x10</td>
<td>TAKE_PLC_RESERVATION</td>
<td>Assign an owner to the PLC</td>
</tr>
<tr>
<td>0x11</td>
<td>RELEASE_PLC_RESERVATION</td>
<td>Release the reservation of a PLC</td>
</tr>
<tr>
<td>0x12</td>
<td>KEEP_ALIVE</td>
<td>Keep alive message</td>
</tr>
<tr>
<td>0x20</td>
<td>READ_MEMORY_BLOCK</td>
<td>Read a memory block of the PLC</td>
</tr>
<tr>
<td>0x22</td>
<td>READ_VARIABLES</td>
<td>Read system bits, system words and strategy variables</td>
</tr>
<tr>
<td>0x23</td>
<td>WRITE_VARIABLES</td>
<td>Write system bits, system words and strategy variables</td>
</tr>
<tr>
<td>0x24</td>
<td>READ_COILS_REGISTERS</td>
<td>Read coils and holding registers from PLC</td>
</tr>
<tr>
<td>0x25</td>
<td>WRITE_COILS_REGISTERS</td>
<td>Write coils and holding registers into PLC</td>
</tr>
<tr>
<td>0x30</td>
<td>INITIALIZE_UPLOAD</td>
<td>Initialize strategy upload (copy from PC to PLC)</td>
</tr>
<tr>
<td>0x31</td>
<td>UPLOAD_BLOCK</td>
<td>Upload a strategy block to the PLC</td>
</tr>
<tr>
<td>0x32</td>
<td>END_STRATEGY_UPLOAD</td>
<td>Finish strategy upload</td>
</tr>
<tr>
<td>0x33</td>
<td>INITIALIZE_DOWNLOAD</td>
<td>Initialize strategy download (copy from PLC to PC)</td>
</tr>
<tr>
<td>0x34</td>
<td>DOWNLOAD_BLOCK</td>
<td>Download a strategy block from the PLC</td>
</tr>
<tr>
<td>0x35</td>
<td>END_STRATEGY_DOWNLOAD</td>
<td>Finish strategy download</td>
</tr>
<tr>
<td>0x39</td>
<td>READ_ETH_MASTER_DATA</td>
<td>Read Ethernet master data</td>
</tr>
<tr>
<td>0x40</td>
<td>START_PLC</td>
<td>Starts the PLC</td>
</tr>
<tr>
<td>0x41</td>
<td>STOP_PLC</td>
<td>Stops the PLC</td>
</tr>
<tr>
<td>0x50</td>
<td>MONITOR_PLC</td>
<td>Monitors variables, systems bits and words</td>
</tr>
<tr>
<td>0x58</td>
<td>CHECK_PLC</td>
<td>Check PLC connection status</td>
</tr>
<tr>
<td>0x60</td>
<td>SET_BREAKPOINT</td>
<td>Set a breakpoint on a specified rung</td>
</tr>
<tr>
<td>0x70</td>
<td>READ_IO_OBJECT</td>
<td>Read IO Object</td>
</tr>
<tr>
<td>0x71</td>
<td>WRITE_IO_OBJECT</td>
<td>Write IO Object</td>
</tr>
<tr>
<td>0x73</td>
<td>GET_STATUS_MODULE</td>
<td>Get status module</td>
</tr>
</tbody>
</table>
<h2 id="modbus-scan-by-scadaploit">Modbus Scan by SCADAploit</h2>
<p>SCADAploit <strong>Modbus Scan</strong> module supports the UMAS extension and this allows us to retrieve more details when dealing with a PLC programmed with UnityPro, such as eg. the name of the CPU module, the memory card model and some data about the project file that has been loaded.</p>
<p>The nature of the Modbus protocol which does not require any authentication facilitates the gathering of information.</p>
<div class="container">
  <img
      src="https://scadasploit.dev/images/2021/scadasploit_scan_5.png"
      class="my_img"
    />
</div>
<p>As we can see, in addition to the standard data we are able to collect important details about the project as well. By giving a practical example of how to use this information, the date of the last modification lets us understand how long the PLC has been in operation without software maintenance interventions. This may mean that it may be exposed to known vulnerabilities discovered at a later date that may not have been addressed.</p>
<h2 id="important-note"><strong>Important note</strong></h2>
<p>This article is intended for educational and informational purposes only. <strong>Any unauthorized action</strong> towards any control system present on a public or private network <strong>is illegal</strong>! The information contained in this and other articles are intended to make people understand how necessary it is to improve defense systems, and not to provide tools for attacking them. Violating a computer system is punishable by law and can cause serious damage to property and people, especially when it comes to ICS. All the tests that are illustrated in the tutorials have been carried out in isolated, safe, or manufacturer-authorized laboratories.</p>
<p>Stay safe, stay free.</p>

      </div>
    </article>

    <hr />

    <div class="post-info">
      
    <p>
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-tag meta-icon"><path d="M20.59 13.41l-7.17 7.17a2 2 0 0 1-2.83 0L2 12V2h10l8.59 8.59a2 2 0 0 1 0 2.82z"></path><line x1="7" y1="7" x2="7" y2="7"></line></svg>

        <span class="tag"><a href="https://scadasploit.dev/tags/scadasploit/">SCADAsploit</a></span>
        
    </p>

      

      <p>
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-file-text">
          <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
          <polyline points="14 2 14 8 20 8"></polyline>
          <line x1="16" y1="13" x2="8" y2="13"></line>
          <line x1="16" y1="17" x2="8" y2="17"></line>
          <polyline points="10 9 9 9 8 9"></polyline>
        </svg>
        975 Words
      </p>

      <p>
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-calendar">
          <rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect>
          <line x1="16" y1="2" x2="16" y2="6"></line>
          <line x1="8" y1="2" x2="8" y2="6"></line>
          <line x1="3" y1="10" x2="21" y2="10"></line>
        </svg>
        
          2022-04-17 15:09
        

         
          
        
      </p>
    </div>
      <hr />

    
    <div class="pagination">
        

        <div class="pagination__buttons">
            
            <span class="button previous">
                <a href="https://scadasploit.dev/posts/2022/04/scadasploit-module-modbus-payload-transfer/">
                    <span class="button__icon">←</span>
                    <span class="button__text">SCADAsploit module: Modbus Payload Transfer</span>
                </a>
            </span>
            

            
            <span class="button next">
                <a href="https://scadasploit.dev/posts/2022/04/scadasploit-framework/">
                    <span class="button__text">SCADAsploit Framework</span>
                    <span class="button__icon">→</span>
                </a>
            </span>
            
        </div>
    </div>


    

    

  </main>

            </div>

            
                <footer class="footer">
    
    <div class="footer__inner">
        <div class="footer__content">
            <span>&copy; 2023</span>
            <span><a href="https://scadasploit.dev">segfaultx00</a></span>
            
            
            <span>Made with &#10084</span>
        </div>
    </div>
    
    
</footer>

            
        </div>

        



<script type="text/javascript" src="https://scadasploit.dev/bundle.min.bb2c6bc3ed452ca4759660e4020811f248bc2320081559e8a32d8b0092773852941133639d35e8370d03d3ddaa750b1edd6b343c5bd22a55d5bdeae8f648f49b.js" integrity="sha512-uyxrw&#43;1FLKR1lmDkAggR8ki8IyAIFVnooy2LAJJ3OFKUETNjnTXoNw0D092qdQse3Ws0PFvSKlXVvero9kj0mw=="></script>



    </body>
</html>
